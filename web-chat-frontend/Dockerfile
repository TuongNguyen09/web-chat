# --- Stage 1: Build React báº±ng Node.js ---
FROM node:20-alpine as build
WORKDIR /app

# Copy file package Ä‘á»ƒ cÃ i thÆ° viá»‡n trÆ°á»›c
COPY package*.json ./
RUN npm ci 

# Copy toÃ n bá»™ code
COPY . .

# ğŸ‘‡ğŸ‘‡ğŸ‘‡ THÃŠM ÄOáº N NÃ€Y VÃ€O TRÆ¯á»šC Lá»†NH BUILD ğŸ‘‡ğŸ‘‡ğŸ‘‡
# Khai bÃ¡o biáº¿n nháº­n tá»« GitHub Actions (Build Args)
ARG REACT_APP_API_URL
ARG REACT_APP_WS_URL
ARG REACT_APP_ENV

# GÃ¡n giÃ¡ trá»‹ vÃ o biáº¿n mÃ´i trÆ°á»ng Ä‘á»ƒ React sá»­ dá»¥ng lÃºc build
ENV REACT_APP_API_URL=$REACT_APP_API_URL
ENV REACT_APP_WS_URL=$REACT_APP_WS_URL
ENV REACT_APP_ENV=$REACT_APP_ENV
# ğŸ‘†ğŸ‘†ğŸ‘† Háº¾T ÄOáº N Cáº¦N THÃŠM ğŸ‘†ğŸ‘†ğŸ‘†

# Build ra thÆ° má»¥c 'build' hoáº·c 'dist'
RUN npm run build

# --- Stage 2: Serve báº±ng Nginx ---
FROM nginx:alpine

# Copy file build tá»« Stage 1 sang thÆ° má»¥c máº·c Ä‘á»‹nh cá»§a Nginx
COPY --from=build /app/build /usr/share/nginx/html

# Copy file cáº¥u hÃ¬nh Nginx custom cá»§a mÃ¬nh vÃ o
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]